CREATE VIEW `count of sales by customer` AS select customer_id, year(saledate) year, month(saledate) month, count(*) purchases from transactions group by customer_id, year(saledate), month(saledate) ;
CREATE VIEW `new customers by month` as with customer_list as (select distinct year(saledate) year, month(saledate) month, customer_id, row_number() over(partition by customer_id order by year(saledate), month(saledate)) cust_rn from transactions) select year, month, count(distinct customer_id) new_customers from customer_list where cust_rn=1 group by year, month order by year, month ;